# 集群安装
## 准备：
* 1. 安装JDK（不是本章重点，自行安装接口）
* 2. 关闭防火墙
```
systemctl stop firewalld.service
systemctl disable firewalld.service
```
* 3. 在每个服务器的/etc/hosts中配置集群所有服务器的host和ip
* 4. 配置ssh免密登录
```
cd /root/.ssh
ssh-keygen -t rsa          #一直回车就行
ssh-copy-id root@test01   #将公钥拷贝到其他服务器，需要root登录密码
```
## 1. 下载Kafka
官网下载地址首页：http://kafka.apache.org/downloads.html
![](https://github.com/lk6678979/image/blob/master/kafka-ssl/kafka-install-1.jpg)
* 我们下载kafka_2.13-2.6.0.tgz，点击跳转：https://www.apache.org/dyn/closer.cgi?path=/kafka/2.6.0/kafka_2.13-2.6.0.tgz
```shell
wget https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.6.0/kafka_2.13-2.6.0.tgz
```
![](https://github.com/lk6678979/image/blob/master/kafka-ssl/kafka-install-2.jpg)

## 2. 安装Kafka
### 2.1 解压kafka
```
tar -xzvf kafka_2.13-2.6.0.tgz 
```
### 2.2 Zookeeper配置
当前下载的kafka程序里自带Zookeeper，可以直接使用其自带的Zookeeper建立集群，也可以单独使用Zookeeper安装文件建立集群,这里直接使用其自带的Zookeeper建立集群  
kafka自带的Zookeeper程序脚本与配置文件名与原生Zookeeper稍有不同：  
* Kafka自带的Zookeeper程序使用bin/zookeeper-server-start.sh，以及bin/zookeeper-server-stop.sh来启动和停止Zookeeper。
* Kafka的Zookeeper的配制文件是config/zookeeper.properties，不是zoo.cfg
* 配置：
```
#计时周期时间，zookeeper中使用的基本时间单位, 毫秒值.
tickTime=2000
#同步限制，该参数配置leader和follower之间发送消息, 请求和应答的最大时间长度. 此时该参数设置为5, 说明时间限制为5倍tickTime, 即10000ms.
syncLimit=5
#初始化限制，zookeeper集群中的包含多台server, 其中一台为leader, 集群中其余的server为follower。 initLimit参数配置初始化连接时, follower和leader之间的最长心跳时间. 此时该参数设置为10, 说明时间限制为5倍tickTime, 即10*2000=20000ms=20s.
initLimit=10
#最大客户端连接数
maxClientCnxns=1000
#最小会话超时
minSessionTimeout=4000
#最大会话超时
maxSessionTimeout=60000
#存储快照文件的目录
dataDir=/data/zk/data
#默认情况下， 事务日志也会存储在该目dataDir录上。由于事务日志 的写性能直接影响 ZooKeeper 性能，因此 建议同时配置参数 dataLogDir
dataLogDir=/data/zk/logs
# 客户端端口
clientPort=2181
# Disable the adminserver by default to avoid port conflicts.
# Set the port to something non-conflicting if choosing to enable this
admin.enableServer=false
# admin.serverPort=8080
#端口号2888表示该服务器与集群中leader交换信息的端口，默认为2888， 3888表示选举时服务器相互通信的端口
#server.X=A:B:C 其中X是一个数字, 表示这是第几号server. A是该server所在的IP地址. B配置该server和集群中的leader交换消息所使用的端口. C配置选举leader时所使用的端口. 由于配置的是伪集群模式, #所以各个server的B, C参数必须不同
server.1=test01:2888:3888
server.2=test02:2888:3888
server.3=test03:2888:3888
```
* 创建myid文件：在${dataDir}路径下创建一个myid文件，myid中只用存放的值就是服务器的编号（例如server.1对应的服务器的myid中的值是1）。ZooKeeper在启动时会读取 myid文件 中的值与 zoo.cfg文件中的配置信息进行比较，以确定是哪台服务器。
### 2.3 Zookeeper启动
```
#加-daemon参数，可以在后台启动Zookeeper，输出的信息在保存在执行目录的logs/zookeeper.out文件中。
bin/zookeeper-server-start.sh -daemon config/zookeeper.properties
```
查看日志
```
cat logs/zookeeper.out
```
日志数据：
```

```













